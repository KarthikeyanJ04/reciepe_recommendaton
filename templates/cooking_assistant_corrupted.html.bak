<!DOCTYPE html><!DOCTYPE html>

<html lang="en"><html lang="en">

<head><head>

    <meta charset="UTF-8">    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>AI Cooking Assistant</title>    <title>AI Cooking Assistant</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>    <style>

        * {        body {

            margin: 0;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            padding: 0;            min-height: 100vh;

            box-sizing: border-box;        }

        }        

        .cooking-assistant {

        body {            max-width: 1000px;

            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;            margin: 30px auto;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            padding: 0 20px;

            min-height: 100vh;        }

            padding: 20px;        

        }        .assistant-container {

            background: white;

        .container {            border-radius: 24px;

            max-width: 1400px;            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);

            margin: 0 auto;            overflow: hidden;

            display: grid;        }

            grid-template-columns: 1fr 2fr 1fr;        

            gap: 20px;        .assistant-header {

            height: 80vh;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

        }            color: white;

            padding: 30px;

        .avatar-panel {            text-align: center;

            background: white;        }

            border-radius: 15px;        

            padding: 20px;        .assistant-header h1 {

            box-shadow: 0 10px 40px rgba(0,0,0,0.2);            font-size: 2.2rem;

            display: flex;            margin-bottom: 10px;

            flex-direction: column;            font-weight: 800;

            align-items: center;        }

            justify-content: center;        

        }        .recipe-info {

            background: rgba(255, 255, 255, 0.1);

        #avatarCanvas {            padding: 15px 20px;

            width: 100%;            border-radius: 12px;

            height: 300px;            margin-top: 15px;

            border-radius: 10px;            font-size: 1.1rem;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        }

        }        

        .assistant-content {

        .avatar-message {            padding: 40px;

            margin-top: 20px;        }

            padding: 15px;        

            background: #f5f5f5;        .ai-avatar {

            border-radius: 10px;            text-align: center;

            text-align: center;            margin-bottom: 30px;

            font-size: 14px;        }

            color: #333;        

            line-height: 1.6;        .avatar-image {

            min-height: 80px;            width: 180px;

            display: flex;            height: 180px;

            align-items: center;            border-radius: 50%;

            justify-content: center;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

        }            display: flex;

            align-items: center;

        .main-panel {            justify-content: center;

            background: white;            margin: 0 auto;

            border-radius: 15px;            font-size: 80px;

            padding: 30px;            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);

            box-shadow: 0 10px 40px rgba(0,0,0,0.2);            animation: pulse 2s infinite;

            overflow-y: auto;        }

        }        

        @keyframes pulse {

        .recipe-header {            0%, 100% { transform: scale(1); }

            margin-bottom: 30px;            50% { transform: scale(1.05); }

            text-align: center;        }

        }        

        .avatar-speaking {

        .recipe-header h1 {            animation: speak 0.5s infinite !important;

            color: #333;        }

            font-size: 28px;        

            margin-bottom: 5px;        @keyframes speak {

        }            0%, 100% { transform: scale(1); }

            50% { transform: scale(1.12); }

        .recipe-header p {        }

            color: #666;        

            font-size: 14px;        .avatar-name {

        }            font-size: 1.4rem;

            font-weight: 700;

        .steps-container {            color: #667eea;

            display: flex;            margin-top: 10px;

            flex-direction: column;        }

            gap: 15px;        

        }        .speech-bubble {

            background: #f0f4ff;

        .step-item {            padding: 25px;

            background: #f9f9f9;            border-radius: 20px;

            border-left: 4px solid #667eea;            border-left: 5px solid #667eea;

            padding: 20px;            margin: 25px 0;

            border-radius: 8px;            position: relative;

            cursor: pointer;            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);

            transition: all 0.3s ease;            min-height: 60px;

            opacity: 0.6;            display: flex;

        }            align-items: center;

        }

        .step-item:hover {        

            background: #f0f0f0;        .speech-bubble p {

            transform: translateX(5px);            font-size: 1.1rem;

        }            line-height: 1.6;

            color: #333;

        .step-item.active {            margin: 0;

            background: #e8eaf6;        }

            border-left-color: #764ba2;        

            opacity: 1;        .steps-section {

            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);            margin-top: 40px;

        }        }

        

        .step-item.completed {        .step-container {

            border-left-color: #4caf50;            margin: 20px 0;

            opacity: 1;            padding: 25px;

        }            background: #f8f9fc;

            border-radius: 16px;

        .step-number {            border: 2px solid #e8eef8;

            display: inline-block;            border-left: 5px solid #ddd;

            width: 30px;            transition: all 0.3s ease;

            height: 30px;            position: relative;

            background: #667eea;        }

            color: white;        

            border-radius: 50%;        .step-number {

            text-align: center;            position: absolute;

            line-height: 30px;            top: 15px;

            font-weight: bold;            left: 15px;

            margin-right: 10px;            width: 40px;

            font-size: 12px;            height: 40px;

        }            border-radius: 50%;

            background: #e8eef8;

        .step-item.completed .step-number {            display: flex;

            background: #4caf50;            align-items: center;

        }            justify-content: center;

            font-weight: 800;

        .step-text {            color: #667eea;

            color: #333;            font-size: 1.1rem;

            font-size: 16px;        }

            margin: 10px 0;        

            line-height: 1.5;        .step-content {

        }            padding-left: 70px;

        }

        .timer-badge {        

            display: inline-block;        .step-text {

            background: #ff9800;            font-size: 1.05rem;

            color: white;            color: #444;

            padding: 5px 12px;            line-height: 1.7;

            border-radius: 20px;            margin-bottom: 15px;

            font-size: 12px;        }

            font-weight: bold;        

            margin-top: 8px;        .step-timer {

        }            display: inline-flex;

            align-items: center;

        .timer-controls {            gap: 8px;

            display: flex;            background: #fff3cd;

            gap: 10px;            padding: 8px 16px;

            margin-top: 12px;            border-radius: 8px;

            align-items: center;            font-weight: 600;

        }            color: #856404;

            font-size: 0.95rem;

        .timer-btn {        }

            padding: 6px 12px;        

            border: none;        .step-active {

            border-radius: 5px;            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);

            font-size: 12px;            border-color: #667eea;

            font-weight: bold;            border-left-color: #667eea;

            cursor: pointer;            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);

            transition: all 0.2s ease;        }

        }        

        .step-completed {

        .timer-start {            opacity: 0.6;

            background: #4caf50;            background: #f0fdf4;

            color: white;            border-left-color: #22c55e;

        }        }

        

        .timer-start:hover {        .step-completed .step-number {

            background: #45a049;            background: #22c55e;

        }            color: white;

        }

        .timer-pause {        

            background: #ff9800;        .step-completed::before {

            color: white;            content: '‚úì';

        }            position: absolute;

            right: 20px;

        .timer-pause:hover {            top: 20px;

            background: #e68900;            font-size: 2rem;

        }            color: #22c55e;

        }

        .timer-stop {        

            background: #f44336;        .timer-display {

            color: white;            font-size: 3.5rem;

        }            text-align: center;

            color: #667eea;

        .timer-stop:hover {            margin: 30px 0;

            background: #da190b;            font-weight: 900;

        }            letter-spacing: -2px;

        }

        .timer-display {        

            font-size: 16px;        .timer-display.timer-active {

            font-weight: bold;            color: #ec4899;

            color: #ff9800;            animation: timerBlink 1s infinite;

            min-width: 80px;        }

        }        

        @keyframes timerBlink {

        .timer-display.active {            0%, 100% { opacity: 1; }

            animation: pulse 1s infinite;            50% { opacity: 0.7; }

        }        }

        

        @keyframes pulse {        .controls {

            0%, 100% { opacity: 1; }            display: flex;

            50% { opacity: 0.7; }            gap: 15px;

        }            justify-content: center;

            margin: 40px 0;

        .sidebar {            flex-wrap: wrap;

            background: white;        }

            border-radius: 15px;        

            padding: 20px;        .control-btn {

            box-shadow: 0 10px 40px rgba(0,0,0,0.2);            padding: 16px 32px;

            overflow-y: auto;            border: none;

        }            border-radius: 12px;

            font-size: 1rem;

        .sidebar-section {            font-weight: 700;

            margin-bottom: 25px;            cursor: pointer;

        }            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            color: white;

        .sidebar-section h3 {            transition: all 0.3s;

            color: #333;            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);

            font-size: 16px;            white-space: nowrap;

            margin-bottom: 12px;        }

            text-transform: uppercase;        

            font-size: 12px;        .control-btn:hover:not(:disabled) {

            color: #999;            transform: translateY(-2px);

            letter-spacing: 1px;            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);

        }        }

        

        .ingredients-list {        .control-btn:disabled {

            list-style: none;            opacity: 0.5;

        }            cursor: not-allowed;

        }

        .ingredients-list li {        

            padding: 8px 0;        .control-btn.pause-btn {

            color: #555;            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);

            font-size: 13px;            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);

            border-bottom: 1px solid #eee;        }

            display: flex;        

            align-items: center;        .progress-bar {

        }            width: 100%;

            height: 8px;

        .ingredients-list li:last-child {            background: #e8eef8;

            border-bottom: none;            border-radius: 10px;

        }            overflow: hidden;

            margin: 30px 0;

        .ingredients-list li:before {        }

            content: "‚úì";        

            display: inline-block;        .progress-fill {

            width: 20px;            height: 100%;

            height: 20px;            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);

            background: #e8eaf6;            border-radius: 10px;

            border-radius: 4px;            transition: width 0.3s ease;

            margin-right: 8px;        }

            color: #667eea;        

            text-align: center;        .completion-message {

            font-size: 12px;            text-align: center;

            font-weight: bold;            padding: 40px;

            line-height: 20px;            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(34, 197, 94, 0.05) 100%);

        }            border-radius: 16px;

            border: 2px solid #22c55e;

        .recipe-info {            margin: 30px 0;

            display: grid;        }

            grid-template-columns: 1fr 1fr;        

            gap: 10px;        .completion-message h2 {

        }            color: #22c55e;

            font-size: 2rem;

        .info-item {            margin-bottom: 10px;

            padding: 10px;        }

            background: #f5f5f5;        

            border-radius: 8px;        .completion-message p {

            text-align: center;            color: #16a34a;

        }            font-size: 1.1rem;

        }

        .info-label {        

            font-size: 11px;        @media (max-width: 768px) {

            color: #999;            .assistant-content {

            text-transform: uppercase;                padding: 25px;

            margin-bottom: 5px;            }

        }            

            .timer-display {

        .info-value {                font-size: 2.5rem;

            font-size: 16px;            }

            font-weight: bold;            

            color: #333;            .control-btn {

        }                padding: 12px 24px;

                font-size: 0.95rem;

        .action-buttons {            }

            display: grid;            

            grid-template-columns: 1fr 1fr;            .avatar-image {

            gap: 10px;                width: 140px;

            margin-top: 20px;                height: 140px;

        }                font-size: 60px;

            }

        .btn {        }

            padding: 12px;    </style>

            border: none;</head>

            border-radius: 8px;<body>

            font-weight: bold;    <div class="cooking-assistant">

            cursor: pointer;        <div class="assistant-container">

            transition: all 0.3s ease;            <div class="assistant-header">

            font-size: 13px;                <h1>AI Cooking Assistant</h1>

        }                <div class="recipe-info" id="recipeInfo">

                    Loading recipe...

        .btn-primary {                </div>

            background: #667eea;            </div>

            color: white;            

        }            <div class="assistant-content">

                <div class="ai-avatar">

        .btn-primary:hover {                    <div class="avatar-image" id="avatar">üë®‚Äçüç≥</div>

            background: #5568d3;                    <div class="avatar-name">Chef AI</div>

        }                </div>

                

        .btn-secondary {                <div class="speech-bubble" id="speechBubble">

            background: #f5f5f5;                    <p id="avatarSpeech">Hi! I'm your AI cooking assistant. Let me guide you through this recipe step by step. Click "Start Cooking" when you're ready!</p>

            color: #333;                </div>

            border: 2px solid #667eea;                

        }                <div class="progress-bar">

                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>

        .btn-secondary:hover {                </div>

            background: #f0f0f0;                

        }                <div id="timerDisplay" class="timer-display" style="display: none;">

                    <span id="timerValue">00:00</span>

        .progress-bar {                </div>

            width: 100%;                

            height: 4px;                <div id="stepsContainer" class="steps-section"></div>

            background: #eee;                

            border-radius: 2px;                <div class="controls">

            margin-top: 10px;                    <button class="control-btn" id="startBtn" onclick="startCooking()">Start Cooking</button>

            overflow: hidden;                    <button class="control-btn" id="nextBtn" onclick="nextStep()" disabled>Next Step</button>

        }                    <button class="control-btn pause-btn" id="pauseBtn" onclick="togglePauseTimer()" disabled style="display: none;">Pause Timer</button>

                </div>

        .progress-fill {            </div>

            height: 100%;        </div>

            background: linear-gradient(90deg, #667eea, #764ba2);    </div>

            width: 0%;    

            transition: width 0.3s ease;    <script>

        }        let currentStep = 0;

        let steps = [];

        @media (max-width: 1200px) {        let timerInterval = null;

            .container {        let remainingSeconds = 0;

                grid-template-columns: 1fr;        let isPaused = false;

            }        let recipe = null;

        

            .avatar-panel {        // Text-to-Speech

                display: none;        function speak(text) {

            }            if ('speechSynthesis' in window) {

        }                const utterance = new SpeechSynthesisUtterance(text);

                utterance.rate = 0.95;

        .no-recipe {                utterance.pitch = 1;

            text-align: center;                utterance.volume = 1;

            padding: 40px 20px;                window.speechSynthesis.speak(utterance);

            color: #666;                

        }                // Animate avatar

                const avatar = document.getElementById('avatar');

        .loading {                avatar.classList.add('avatar-speaking');

            display: flex;                setTimeout(() => {

            justify-content: center;                    avatar.classList.remove('avatar-speaking');

            align-items: center;                }, Math.min(text.length * 60, 5000));

            height: 100%;            }

        }        }

        

        .spinner {        // Load recipe

            border: 4px solid #f3f3f3;        async function loadRecipe(recipeId) {

            border-top: 4px solid #667eea;            try {

            border-radius: 50%;                const response = await fetch('/cook-with-ai', {

            width: 40px;                    method: 'POST',

            height: 40px;                    headers: {'Content-Type': 'application/json'},

            animation: spin 1s linear infinite;                    body: JSON.stringify({recipe_id: recipeId})

        }                });

                

        @keyframes spin {                const data = await response.json();

            0% { transform: rotate(0deg); }                if (data.success) {

            100% { transform: rotate(360deg); }                    recipe = data.recipe;

        }                    steps = data.parsed_steps;

    </style>                    displayRecipeInfo();

</head>                    displaySteps();

<body>                    speak(`Great! Let's cook ${recipe.name}. I'll guide you through ${steps.length} steps. Click Start Cooking when ready!`);

    <div class="container">                } else {

        <!-- Avatar Panel -->                    document.getElementById('avatarSpeech').textContent = 'Sorry, could not load the recipe. Please try again.';

        <div class="avatar-panel">                }

            <canvas id="avatarCanvas"></canvas>            } catch (error) {

            <div class="avatar-message" id="avatarMessage">                console.error('Error:', error);

                Welcome! Let's cook something delicious today!                document.getElementById('avatarSpeech').textContent = 'Error loading recipe. Please refresh and try again.';

            </div>            }

        </div>        }

        

        <!-- Main Panel -->        function displayRecipeInfo() {

        <div class="main-panel">            const info = document.getElementById('recipeInfo');

            <div id="contentArea">            info.innerHTML = `<strong>${recipe.name}</strong> ‚Ä¢ ${recipe.cuisine || 'Indian'} Cuisine ‚Ä¢ ${recipe.prep_time || 'N/A'}`;

                <div class="loading">        }

                    <div class="spinner"></div>        

                </div>        function displaySteps() {

            </div>            const container = document.getElementById('stepsContainer');

        </div>            container.innerHTML = steps.map((step, i) => `

                <div class="step-container" id="step-${i}">

        <!-- Sidebar -->                    <div class="step-number">${i + 1}</div>

        <div class="sidebar">                    <div class="step-content">

            <div class="sidebar-section">                        <div class="step-text">${step.text}</div>

                <h3>Recipe Info</h3>                        ${step.has_timer && step.timers.length > 0 ? `<span class="step-timer">‚è±Ô∏è ${Math.floor(step.timers[0])} min wait</span>` : ''}

                <div class="recipe-info" id="recipeInfo">                    </div>

                    <div class="info-item">                </div>

                        <div class="info-label">Prep Time</div>            `).join('');

                        <div class="info-value">--</div>        }

                    </div>        

                    <div class="info-item">        function updateProgressBar() {

                        <div class="info-label">Category</div>            const progress = currentStep / steps.length * 100;

                        <div class="info-value">--</div>            document.getElementById('progressFill').style.width = progress + '%';

                    </div>        }

                </div>        

            </div>        function startCooking() {

            document.getElementById('startBtn').disabled = true;

            <div class="sidebar-section">            document.getElementById('nextBtn').disabled = false;

                <h3>Ingredients</h3>            speak(`Starting with step 1. ${steps[0].text}`);

                <ul class="ingredients-list" id="ingredientsList"></ul>            nextStep();

            </div>        }

        

            <div class="action-buttons">        function nextStep() {

                <button class="btn btn-primary" onclick="nextStep()">Next Step</button>            if (currentStep >= steps.length) {

                <button class="btn btn-secondary" onclick="previousStep()">Previous</button>                showCompletion();

            </div>                return;

        </div>            }

    </div>            

            // Mark previous step as completed

    <script src="https://cdn.jsdelivr.net/npm/three@r128/build/three.min.js"></script>            if (currentStep > 0) {

    <script>                document.getElementById(`step-${currentStep - 1}`).classList.add('step-completed');

        let currentRecipeId = null;                document.getElementById(`step-${currentStep - 1}`).classList.remove('step-active');

        let currentStep = 0;            }

        let steps = [];            

        let timers = {};            // Highlight current step

        let currentTimer = null;            const stepEl = document.getElementById(`step-${currentStep}`);

            stepEl.classList.add('step-active');

        // Initialize 3D Avatar            

        function initAvatar() {            const step = steps[currentStep];

            const canvas = document.getElementById('avatarCanvas');            document.getElementById('avatarSpeech').textContent = step.text;

            const scene = new THREE.Scene();            speak(step.text);

            const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);            

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });            updateProgressBar();

                        

            renderer.setSize(canvas.clientWidth, canvas.clientHeight);            // Start timer if needed

            renderer.setClearColor(0x667eea, 0.1);            if (step.has_timer && step.timers.length > 0) {

                startTimer(step.timers[0]);

            // Create avatar head            } else {

            const headGeometry = new THREE.SphereGeometry(1, 32, 32);                currentStep++;

            const headMaterial = new THREE.MeshStandardMaterial({             }

                color: 0xffdbac,        }

                metalness: 0.1,        

                roughness: 0.8        function startTimer(minutes) {

            });            remainingSeconds = Math.floor(minutes * 60);

            const head = new THREE.Mesh(headGeometry, headMaterial);            document.getElementById('timerDisplay').style.display = 'block';

            head.position.y = 0.5;            document.getElementById('pauseBtn').style.display = 'inline-block';

            scene.add(head);            document.getElementById('nextBtn').disabled = true;

            isPaused = false;

            // Create eyes            document.getElementById('pauseBtn').textContent = 'Pause Timer';

            const eyeGeometry = new THREE.SphereGeometry(0.15, 32, 32);            

            const eyeMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });            const minuteText = minutes === 1 ? '1 minute' : `${Math.floor(minutes)} minutes`;

                        speak(`Starting timer for ${minuteText}. I'll let you know when it's done!`);

            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);            

            leftEye.position.set(-0.3, 1.2, 0.8);            timerInterval = setInterval(() => {

            scene.add(leftEye);                if (!isPaused) {

                    remainingSeconds--;

            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);                    updateTimerDisplay();

            rightEye.position.set(0.3, 1.2, 0.8);                    

            scene.add(rightEye);                    if (remainingSeconds <= 0) {

                        clearInterval(timerInterval);

            // Create smile                        document.getElementById('timerDisplay').classList.remove('timer-active');

            const smileGeometry = new THREE.BufferGeometry();                        document.getElementById('pauseBtn').style.display = 'none';

            const smilePoints = [];                        document.getElementById('nextBtn').disabled = false;

            for (let i = 0; i <= 10; i++) {                        speak("Timer finished! The cooking step is complete. Click Next Step to continue.");

                const angle = Math.PI - (i / 10) * Math.PI;                        playAlarm();

                smilePoints.push(                        currentStep++;

                    new THREE.Vector3(Math.cos(angle) * 0.3, 0.7 + Math.sin(angle) * 0.2, 0.8)                    }

                );                }

            }            }, 1000);

            smileGeometry.setFromPoints(smilePoints);        }

            const smileMaterial = new THREE.LineBasicMaterial({ color: 0x333333, linewidth: 3 });        

            const smile = new THREE.Line(smileGeometry, smileMaterial);        function updateTimerDisplay() {

            scene.add(smile);            const mins = Math.floor(remainingSeconds / 60);

            const secs = remainingSeconds % 60;

            // Create body            const display = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

            const bodyGeometry = new THREE.CapsuleGeometry(0.5, 2, 4, 8);            document.getElementById('timerValue').textContent = display;

            const bodyMaterial = new THREE.MeshStandardMaterial({             document.getElementById('timerDisplay').classList.add('timer-active');

                color: 0x667eea,        }

                metalness: 0.2,        

                roughness: 0.8        function togglePauseTimer() {

            });            isPaused = !isPaused;

            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);            const btn = document.getElementById('pauseBtn');

            body.position.y = -1;            btn.textContent = isPaused ? 'Resume Timer' : 'Pause Timer';

            scene.add(body);            if (isPaused) {

                speak('Timer paused');

            // Lighting            } else {

            const light1 = new THREE.DirectionalLight(0xffffff, 0.8);                speak('Timer resumed');

            light1.position.set(5, 5, 5);            }

            scene.add(light1);        }

        

            const light2 = new THREE.DirectionalLight(0xffffff, 0.4);        function showCompletion() {

            light2.position.set(-5, 5, -5);            document.getElementById(`step-${currentStep - 1}`).classList.add('step-completed');

            scene.add(light2);            

            const container = document.getElementById('stepsContainer');

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);            const completionMsg = `

            scene.add(ambientLight);                <div class="completion-message">

                    <h2>üéâ Cooking Complete!</h2>

            camera.position.z = 3;                    <p>You've successfully prepared ${recipe.name}. Enjoy your delicious meal!</p>

                </div>

            // Animation loop            `;

            function animate() {            container.innerHTML += completionMsg;

                requestAnimationFrame(animate);            

                            document.getElementById('startBtn').style.display = 'none';

                head.rotation.y += 0.005;            document.getElementById('nextBtn').style.display = 'none';

                body.rotation.y += 0.003;            document.getElementById('pauseBtn').style.display = 'none';

                            

                // Eyes blink            document.getElementById('avatarSpeech').textContent = `Congratulations! Your ${recipe.name} is ready to serve! Enjoy your delicious meal! üçΩÔ∏è`;

                const eyeScale = Math.sin(Date.now() * 0.001) > 0.99 ? 0.1 : 1;            speak(`Congratulations! Your ${recipe.name} is ready to serve! Enjoy your delicious meal!`);

                leftEye.scale.y = eyeScale;            

                rightEye.scale.y = eyeScale;            updateProgressBar();

        }

                renderer.render(scene, camera);        

            }        function playAlarm() {

            animate();            // Play a simple beep using Web Audio API

            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Handle window resize            const oscillator = audioContext.createOscillator();

            window.addEventListener('resize', () => {            const gainNode = audioContext.createGain();

                const width = canvas.clientWidth;            

                const height = canvas.clientHeight;            oscillator.connect(gainNode);

                camera.aspect = width / height;            gainNode.connect(audioContext.destination);

                camera.updateProjectionMatrix();            

                renderer.setSize(width, height);            oscillator.frequency.value = 1000;

            });            oscillator.type = 'sine';

        }            

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);

        // Load recipe from URL params            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

        function loadRecipe() {            

            const params = new URLSearchParams(window.location.search);            oscillator.start(audioContext.currentTime);

            currentRecipeId = params.get('recipe_id');            oscillator.stop(audioContext.currentTime + 0.5);

        }

            if (!currentRecipeId) {        

                document.getElementById('contentArea').innerHTML = `        // Get recipe ID from URL

                    <div class="no-recipe">        const urlParams = new URLSearchParams(window.location.search);

                        <p>Please select a recipe from the search results to start cooking!</p>        const recipeId = urlParams.get('recipe_id') || 1;

                    </div>        loadRecipe(recipeId);

                `;    </script>

                return;</body>

            }</html>


            fetch('/cook-with-ai', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ recipe_id: parseInt(currentRecipeId) })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    displayRecipe(data.recipe, data.parsed_steps);
                } else {
                    document.getElementById('contentArea').innerHTML = `
                        <div class="no-recipe">
                            <p>Error: ${data.error}</p>
                        </div>
                    `;
                }
            })
            .catch(err => {
                console.error('Error:', err);
                document.getElementById('contentArea').innerHTML = `
                    <div class="no-recipe">
                        <p>Failed to load recipe. Please try again.</p>
                    </div>
                `;
            });
        }

        function displayRecipe(recipe, parsedSteps) {
            steps = parsedSteps;
            
            // Update sidebar info
            document.getElementById('recipeInfo').innerHTML = `
                <div class="info-item">
                    <div class="info-label">Prep Time</div>
                    <div class="info-value">${recipe.prep_time || '--'}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Category</div>
                    <div class="info-value">${recipe.category || '--'}</div>
                </div>
            `;

            // Update ingredients
            const ingredientsList = document.getElementById('ingredientsList');
            ingredientsList.innerHTML = recipe.ingredients.map(ing => `<li>${ing}</li>`).join('');

            // Display steps
            displaySteps();
            currentStep = 0;
            updateActiveStep();
        }

        function displaySteps() {
            const stepsHtml = steps.map((step, idx) => `
                <div class="step-item" data-step="${idx}" onclick="goToStep(${idx})">
                    <div>
                        <span class="step-number">${idx + 1}</span>
                        <span class="step-text">${step.text}</span>
                    </div>
                    ${step.timers.length > 0 ? `
                        <div class="timer-badge">
                            ‚è±Ô∏è ${step.timers[0]} min
                        </div>
                        <div class="timer-controls">
                            <button class="timer-btn timer-start" onclick="startTimer(${idx}); event.stopPropagation();">Start</button>
                            <button class="timer-btn timer-pause" onclick="pauseTimer(${idx}); event.stopPropagation();">Pause</button>
                            <button class="timer-btn timer-stop" onclick="stopTimer(${idx}); event.stopPropagation();">Stop</button>
                            <span class="timer-display" id="timer-${idx}"></span>
                        </div>
                    ` : ''}
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
            `).join('');

            document.getElementById('contentArea').innerHTML = `
                <div class="recipe-header">
                    <h1>Let's Cook!</h1>
                    <p>Follow each step carefully. Click on a step to navigate.</p>
                </div>
                <div class="steps-container">${stepsHtml}</div>
            `;
        }

        function updateActiveStep() {
            document.querySelectorAll('.step-item').forEach((el, idx) => {
                el.classList.remove('active', 'completed');
                if (idx === currentStep) {
                    el.classList.add('active');
                    updateAvatarMessage(steps[idx].text);
                } else if (idx < currentStep) {
                    el.classList.add('completed');
                }
            });

            // Update progress
            const progress = ((currentStep + 1) / steps.length) * 100;
            document.querySelectorAll('.progress-fill').forEach((el, idx) => {
                if (idx === currentStep) {
                    el.style.width = progress + '%';
                }
            });
        }

        function updateAvatarMessage(text) {
            const messageEl = document.getElementById('avatarMessage');
            const messages = [
                `Now: ${text.substring(0, 100)}${text.length > 100 ? '...' : ''}`,
                'Keep up the great work! üë®‚Äçüç≥',
                'You\'re doing amazing! üåü',
                'Follow the steps carefully! üìù'
            ];
            messageEl.textContent = messages[0];
        }

        function goToStep(idx) {
            currentStep = idx;
            updateActiveStep();
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateActiveStep();
                document.querySelector(`[data-step="${currentStep}"]`).scrollIntoView({ behavior: 'smooth' });
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                updateActiveStep();
                document.querySelector(`[data-step="${currentStep}"]`).scrollIntoView({ behavior: 'smooth' });
            }
        }

        function startTimer(stepIdx) {
            if (!steps[stepIdx].timers.length) return;

            stopTimer(stepIdx); // Clear any existing timer
            
            const minutes = steps[stepIdx].timers[0];
            let secondsLeft = minutes * 60;
            const timerEl = document.getElementById(`timer-${stepIdx}`);

            const timerInterval = setInterval(() => {
                secondsLeft--;
                
                const mins = Math.floor(secondsLeft / 60);
                const secs = secondsLeft % 60;
                timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                timerEl.classList.add('active');

                if (secondsLeft <= 0) {
                    clearInterval(timerInterval);
                    timerEl.classList.remove('active');
                    timerEl.textContent = 'Done!';
                    updateAvatarMessage('Great! Timer finished. Move to the next step! ‚è∞');
                    
                    // Auto-advance to next step
                    setTimeout(() => {
                        nextStep();
                    }, 3000);
                }
            }, 1000);

            timers[stepIdx] = timerInterval;
        }

        function pauseTimer(stepIdx) {
            if (timers[stepIdx]) {
                clearInterval(timers[stepIdx]);
                timers[stepIdx] = null;
                const timerEl = document.getElementById(`timer-${stepIdx}`);
                timerEl.classList.remove('active');
            }
        }

        function stopTimer(stepIdx) {
            pauseTimer(stepIdx);
            const timerEl = document.getElementById(`timer-${stepIdx}`);
            if (timerEl) {
                timerEl.textContent = '';
                timerEl.classList.remove('active');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            initAvatar();
            loadRecipe();
        });
    </script>
</body>
</html>
